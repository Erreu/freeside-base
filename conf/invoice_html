<STYLE TYPE="text/css">
.invoice { font-family: sans-serif; font-size: 10pt }
.invoice_header { font-size: 10pt }
.invoice_headerright TH { border-top: 2px solid #000000; border-bottom: 2px solid #000000 }
.invoice_headerright TD { font-size: 10pt; empty-cells: show }
.invoice_longtable table { cellspacing: none }
.invoice_longtable TH { border-top: 2px solid #000000; border-bottom: 1px solid #000000; padding-left: none; padding-right: none; font-size: 10pt }
.invoice_desc TD { border-top: 2px solid #000000; font-weight: bold; font-size: 10pt }
.invoice_extdesc TD { font-size: 8pt }
.invoice_totaldesc TD { font-size: 10pt; empty-cells: show }
</STYLE>

<table class="invoice" bgcolor="#ffffff" WIDTH=768 CELLSPACING=8><tr><td>

  <table class="invoice_header" width="100%">
    <tr>
     <td><img src="<%= $cid ? "cid:$cid" : "cust_bill-logo.cgi?$template" %>"></td>
     <td align="left"><%= $returnaddress %></td>
      <td align="right">
        <table CLASS="invoice_headerright" cellspacing=0>
          <tr>
            <td align="center">
              Invoice&nbsp;date<BR>
              <B><%= $date %></B>
            </td>
            <td>
            </td>
            <td align="center">
              Invoice&nbsp;#<BR>
              <B><%= $invnum %></B>
            </td>
            <td>
            </td>
            <td align="center">
              Customer #<BR>
              <B><%= $custnum %></B>
            </td>
          </tr>
          <tr>
            <th>&nbsp;</th>
            <th colspan=3 align="center">
              <FONT SIZE="+3">I</FONT><FONT SIZE="+2">NVOICE</FONT>
            </th>
            <th>&nbsp;</th>
          </tr>
        </table>
      </td>
    </tr>

    <tr>
      <td>
      </td>
      <td align="left">
        <b><%= $payname %></b><BR>
        <%= join('<BR>', grep length($_), $company,
                                          $address1,
                                          $address2,
                                          "$city,&nbsp;$state&nbsp;&nbsp;$zip",
                                          $country,
                )
        %>
      </td>
      <%= $ship_enable ? ('<td align="left">'.
                          join('<BR>',grep length($_), '<b>Service Address</b>',
                                                       $ship_company,
                                                       $ship_address1,
                                                       $ship_address2,
                                                       "$ship_city,&nbsp;$ship_state&nbsp;$ship_zip",
                                                       $ship_country,
                                                       ' ',
                                                       ' ',
                              ).
                           ($agent_custid ? "<b>ID:</b> $agent_custid<BR>" : '').
                           ($ship_fax ? "<b>Fax:</b> $ship_fax<BR>" : '').
                           '</td><tr><td></td><td></td>'
                         )
                       : ''
      %>
      <td align="right">
        Terms: <%= $terms %><BR>
        <%= $po_line %>
      </td>
    </tr>

  </table>

  <p><b><font size="+1">C</font><font size="+0">HARGES</font></b>
  <p>
  <table class="invoice_longtable" CELLSPACING=0 WIDTH="100%">
    <tr>
      <th align="center">Ref</th>
      <th align="left">Description</th>
      <%= ( $unitprices 
              ? '<th align="left">Unit Price</th>'.
                '<th align="left">Quantity</th>'
              : ''
            )
      %>
      <th align="right">Amount</th>
    </tr>
    <%=

      foreach my $line ( @detail_items ) {
        $OUT .=
          '<tr class="invoice_desc">'.
            '<td align="center">'. $line->{'ref'}. '</td>'.
            '<td align="left">'. $line->{'description'}. '</td>'.
            ( $unitprices 
                ? '<td align="left">'. $line->{'unit_amount'}. '</td>'.
                  '<td align="left">'. $line->{'quantity'}. '</td>'
                : ''
            ).
            '<td align="right">'. $line->{'amount'}. '</td>'.
          '</tr>'
        ;
        if ( @{$line->{'ext_description'} } ) {
          $OUT .= '<tr class="invoice_extdesc"><td></td><td';
          $OUT .= $unitprices ? ' colspan=3>' : '>';
          $OUT .= '<table width="100%">';
          foreach my $ext_desc ( @{$line->{'ext_description'} } ) {
            $OUT .=
              '<tr class="invoice_extdesc">'.
                '<td align="left">&nbsp;&nbsp;'. $ext_desc. '</td>'.
              '</tr>'
          }
          $OUT .= '</table></td><td></td></tr>';
        }
      }

      my $style = 'border-top: 3px solid #000000;';
      my $linenum = 0;

      foreach my $line ( @total_items ) {

        $style .= 'border-bottom: 3px solid #000000;'
          if ++$linenum == scalar(@total_items);

        $OUT .=
          '<tr class="invoice_totaldesc">'.
            qq(<td style="$style">&nbsp;</td>).
            qq(<td align="left" style="$style").
            ( $unitprices ? ' colspan=3>' : '>' ).
              $line->{'total_item'}. '</td>'.
            qq(<td align="right" style="$style">).
              $line->{'total_amount'}. '</td>'.
          '</tr>'
        ;

        $style='';

      }

    %>
  </table>
  <br><br>

<%= $notes %>

  <hr NOSHADE SIZE=2 COLOR="#000000">
  <p align="center"><%= $footer %>

</td></tr></table>
