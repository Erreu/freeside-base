<% &ntable("#cccccc") %>

%# agent
<% include('/elements/tr-select-agent.html', 
              'curr_value'    => $cust_main->agentnum,
              'label'         => "<B>${r}Agent</B>",
              'empty_label'   => 'Select agent',
              'disable_empty' => ( $cust_main->agentnum ? 1 : 0 ),
           )
%>

%# agent_custid
% if ( $conf->exists('cust_main-edit_agent_custid') ) {

    <TR>
      <TD ALIGN="right">Customer identifier</TD>
      <TD><INPUT TYPE="text" NAME="agent_custid" VALUE="<% $cust_main->agent_custid %>"></TD>
    </TR>

% } else {

    <INPUT TYPE="hidden" NAME="agent_custid" VALUE="<% $cust_main->agent_custid %>">

% }

%# referral (advertising source)
%my $refnum = $cust_main->refnum || $conf->config('referraldefault') || 0;
%if ( $custnum && ! $conf->exists('editreferrals') ) {

  <INPUT TYPE="hidden" NAME="refnum" VALUE="<% $refnum %>">

% } else { 

   <% include('/elements/tr-select-part_referral.html',
                'curr_value' => $refnum
             )
   %>
% } 


%# referring customer
%my $referring_cust_main = '';
%if ( $cust_main->referral_custnum
%     and $referring_cust_main =
%           qsearchs('cust_main', { custnum => $cust_main->referral_custnum } )
%) {

  <TR>
    <TD ALIGN="right">Referring customer</TD>
    <TD>
      <A HREF="<% popurl(1) %>/cust_main.cgi?<% $cust_main->referral_custnum %>"><% $cust_main->referral_custnum %>: <% $referring_cust_main->name %></A>
    </TD>
  </TR>
  <INPUT TYPE="hidden" NAME="referral_custnum" VALUE="<% $cust_main->referral_custnum %>">
% } elsif ( ! $conf->exists('disable_customer_referrals') ) { 


  <TR>
    <TD ALIGN="right">Referring customer</TD>
    <TD>
      <!-- <INPUT TYPE="text" NAME="referral_custnum" VALUE=""> -->
      <% include('/elements/search-cust_main.html',
                    'field_name' => 'referral_custnum',
                 )
      %>
    </TD>
  </TR>
% } else { 


  <INPUT TYPE="hidden" NAME="referral_custnum" VALUE="">
% } 

%# signup date
% if ( $conf->exists('cust_main-edit_signupdate') ) {
    <% include('/elements/tr-input-date-field.html', {
                  'name'        => 'signupdate',
                  'value'       => $cust_main->signupdate,
                  'label'       => 'Signup date',
                  'format'      => $conf->config('date_format') || "%m/%d/%Y",
              })
    %>
% }

</TABLE>

<%init>

my( $cust_main, %opt ) = @_;

my $custnum = $opt{'custnum'};

my $conf = new FS::Conf;

my $r = qq!<font color="#ff0000">*</font>&nbsp;!;

</%init>
