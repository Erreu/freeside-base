<% include( 'elements/svc_Common.html',
               'table'    => 'svc_phone',
               'args_callback' => $args_callback,
	       'value_callback' => $value_callback,
           )
%>
<%init>

die "access denied"
  unless $FS::CurrentUser::CurrentUser->access_right('Provision customer service'); #something else more specific?

my $tollfreephonenum = $cgi->param('tollfreephonenum');
$cgi->param('phonenum',$tollfreephonenum) if $tollfreephonenum =~ /^\d+$/;

my $args_callback = sub {
  my( $cgi, $object ) = @_;

  my %opt = ();
  if ( $cgi->param('locationnum') == -1 ) {
    my $cust_location = new FS::cust_location {
      map { $_ => scalar($cgi->param($_)) }
          qw( custnum address1 address2 city county state zip country )
    };
    $opt{'cust_location'} = $cust_location;
  }

  %opt;

};

my $value_callback = sub {
     my ($field, $value) = @_;
     ($field =~ /_date$/) ? parse_datetime($value) : $value;
};

</%init>
