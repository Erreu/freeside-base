<% include('/elements/header.html', 'Customer Report' ) %>

<FORM ACTION="cust_main.html" METHOD="GET">
<INPUT TYPE="hidden" NAME="magic" VALUE="bill">

  <TABLE BGCOLOR="#cccccc" CELLSPACING=0>

    <TR>
      <TH BGCOLOR="#e8e8e8" COLSPAN=2 ALIGN="left"><FONT SIZE="+1">Search options</FONT></TH>
    </TR>

    <% include( '/elements/tr-select-agent.html',
                  'curr_value'    => scalar($cgi->param('agentnum')),
                  'disable_empty' => 0,
               )
    %>

    <% include( '/elements/tr-select-cust_main-status.html',
                  'label' => 'Status'
              )
    %>


%   foreach my $field (qw( signupdate )) {

      <TR>
        <TD ALIGN="right" VALIGN="center"><% $label{$field} %></TD>
        <TD>
          <TABLE>
            <% include( '/elements/tr-input-beginning_ending.html',
                          prefix   => $field,
                          layout   => 'horiz',
                      )
            %>
          </TABLE>
        </TD>
      </TR>

%   }

    <% include( '/elements/tr-select-payby.html',
                  'payby_type' => 'cust',
                  'multiple'   => 1,
                  'curr_value' => { map { $_ => 1 } FS::payby->cust_payby },
              )
    %>
    
    <% include( '/elements/tr-input-lessthan_greaterthan.html',
                  label   => 'Current balance',
                  field   => 'current_balance',
              )
    %>

    <TR>
      <TD ALIGN="right" VALIGN="center">Include cancelled packages</TD>
        <TD><INPUT TYPE="checkbox" NAME="cancelled_pkgs"></TD>
    </TR>

%   if ( $conf->exists('cust_main-require_censustract') ) {

    <TR>
      <TD ALIGN="right" VALIGN="center">Without census tract</TD>
        <TD><INPUT TYPE="checkbox" NAME="no_censustract"></TD>
    </TR>

%   }

    <TR>
      <TH BGCOLOR="#e8e8e8" COLSPAN=2>&nbsp;</TH>
    </TR>

    <TR>
      <TH BGCOLOR="#e8e8e8" COLSPAN=2 ALIGN="left"><FONT SIZE="+1">Display options</FONT></TH>
    </TR>
    <% include( '/elements/tr-select-cust-fields.html' ) %>

    <TR>
      <TD ALIGN="right" VALIGN="center">Add package columns</TD>
        <TD><INPUT TYPE="checkbox" NAME="flattened_pkgs"></TD>
    </TR>
  </TABLE>

<BR>
<INPUT TYPE="submit" VALUE="Get Report">

</FORM>

<% include('/elements/footer.html') %>
<%init>

die "access denied"
  unless ( $FS::CurrentUser::CurrentUser->access_right('List customers') &&
           $FS::CurrentUser::CurrentUser->access_right('List packages')
         );;

my $conf = new FS::Conf;

</%init>
<%once>

my %label = (
  'signupdate'     => 'Signup date',
);

</%once>
