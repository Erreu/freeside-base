<% include('/elements/header.html', 'Credit report' ) %>

<FORM ACTION="cust_credit.html" METHOD="GET">
<INPUT TYPE="hidden" NAME="magic" VALUE="_date">

<TABLE>
  <TR>
    <TD ALIGN="right">Credits by employee: </TD>

    <TD>
      <SELECT NAME="otaker">
        <OPTION VALUE="">all</OPTION>
%       foreach my $otaker ( @otakers ) { 
          <OPTION VALUE="<% $otaker %>"><% $otaker %></OPTION>
%       } 
      </SELECT>
    </TD>
  </TR>

  <% include( '/elements/tr-select-agent.html',
                 ($cgi->param('agentnum') || ''),
                 'label' => 'for agent: ',
             )
  %>

  <% include( '/elements/tr-input-beginning_ending.html' ) %>

  <% include( '/elements/tr-input-lessthan_greaterthan.html',
                'label' => 'Amount',
		'field' => 'amount',
            )
  %>

</TABLE>

<BR>
<INPUT TYPE="submit" VALUE="Get Report">

</FORM>

<% include('/elements/footer.html') %>

<%init>

die "access denied"
  unless $FS::CurrentUser::CurrentUser->access_right('Financial reports');

my $sth = dbh->prepare("SELECT DISTINCT otaker FROM cust_credit")
  or die dbh->errstr;
$sth->execute or die $sth->errstr;
my @otakers = map { $_->[0] } @{$sth->fetchall_arrayref};

</%init>
