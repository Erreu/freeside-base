<% include('/elements/header.html', 'Call Detail Record Search' ) %>

<FORM ACTION="cdr.html" METHOD="GET">

<TABLE BGCOLOR="#cccccc" CELLSPACING=0>

  <TR>
    <TH CLASS="background" COLSPAN=2 ALIGN="left">
      <FONT SIZE="+1">Search options</FONT>
    </TH>
  </TR>

  <TR>
    <TD ALIGN="right">Status: </TD>
    <TD>
      <SELECT NAME="freesidestatus">
        <OPTION VALUE="">(all)
        <OPTION VALUE="NULL">unprocessed
        <OPTION VALUE="done">processed
      </SELECT>
    </TD>
  </TR>

% #if ( ) {  # disable for everyone not using termination billing...
%   foreach my $termpart ( 1..1 ) { #qsearch('part_termination

    <TR>
      <TD ALIGN="right">Termination Status: </TD>
      <TD>
        <SELECT NAME="termpart<%$termpart%>status">
          <OPTION VALUE="">(all)
          <OPTION VALUE="NULL">unprocessed
          <OPTION VALUE="done">processed
        </SELECT>
      </TD>
    </TR>

%   }
% #}

  <% include ( '/elements/tr-input-beginning_ending.html' ) %>

  <TR>
    <TD ALIGN="right">Source #: </TD>
    <TD>
      <INPUT TYPE="text" NAME="src">
    </TD>
  </TR>

  <TR>
    <TD ALIGN="right">Destination #: </TD>
    <TD>
      <INPUT TYPE="text" NAME="dst">
    </TD>
  </TR>

  <TR>
    <TD ALIGN="right">Destination Context: </TD>
    <TD>
      <INPUT TYPE="text" NAME="dcontext">
    </TD>
  </TR>


  <TR>
    <TD ALIGN="right">Charged Party #: </TD>
    <TD>
      <INPUT TYPE="text" NAME="charged_party">
    </TD>
  </TR>

  <% include( '/elements/tr-input-lessthan_greaterthan.html',
                'label' => 'Duration (sec)',
                'field' => 'duration',
            )
  %>

  <% include( '/elements/tr-input-lessthan_greaterthan.html',
                'label' => 'Billable duration (sec)',
                'field' => 'billsec',
            )
  %>

  <% include( '/elements/tr-select-cdrbatch.html' ) %>

  <TR>
    <TD ALIGN="right">Acct ID (one per-line):</TD>
    <TD><TEXTAREA NAME="acctid"></TEXTAREA></TD>
  </TR>

  <TR>
    <TH CLASS="background" COLSPAN=2>&nbsp;</TH>
  </TR>

  <TR>
    <TH CLASS="background" COLSPAN=2 ALIGN="left"><FONT SIZE="+1">Display options</FONT></TH>
  </TR>

  <INPUT TYPE="hidden" NAME="show" VALUE="1">

  <TR>
    <TD COLSPAN=2>
      <% include('/elements/checkboxes.html',
                   'names_list'          => $names_list,
                   'element_name_prefix' => 'show_',
                   'checked_callback'    => sub { $show_default{$_[1]} },
                                                  # my($cgi, $name) = @_;
                )
      %>
    </TD>
  </TR>

</TABLE>

<BR>
<INPUT TYPE="submit" VALUE="Search Call Detail Records">

</FORM>

<% include('/elements/footer.html') %>
<%init>

die "access denied"
  unless $FS::CurrentUser::CurrentUser->access_right('List rating data');

my @fields = fields('cdr');
my $labels = FS::cdr->table_info->{'fields'};

#XXX config
my @show_default = qw(
  calldate clid src dst dcontext charged_party
  startdate answerdate enddate duration billsec
  disposition amaflags accountcode userfield
  rated_price upstream_price carrierid 
  svcnum freesidestatus freesiderewritestatus
);
my %show_default = map { $_=>1 } @show_default;

my $names_list = [ map {
                         [ $_ => {
                                   'label' => 'Show '. ( $labels->{$_} || $_ )
                                 }
                         ]
                       } 
                   @fields
                 ];

</%init>
