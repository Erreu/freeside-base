<% include( 'elements/search.html',
               'title' => $title,
               'name'  => 'call detail records',
               'query' => { 'table'   => 'cdr',
                            'hashref' => $hashref
                          },
               'count_query' => $count_query,
               'header' => [ fields('cdr') ], #XXX fill in some nice names
               'fields' => [ fields('cdr') ], #XXX fill in some pretty-print
                                              # processing, etc.
             )
%>
<%init>

die "access denied"
  unless $FS::CurrentUser::CurrentUser->access_right('List rating data');

my $title = 'Call Detail Records';
my $hashref = {};
my $count_query = 'SELECT COUNT(*) FROM cdr';

#process params for CDR search, populate $hashref...
# and fixup $count_query

if ( $cgi->param('freesidestatus') eq 'NULL' ) {

  my $title = "Unprocessed $title";
  $hashref->{'freesidestatus'} = ''; # Record.pm will take care of it
  #$count_query .= " AND ( freesidestatus IS NULL OR freesidestatus = '' )";
  $count_query .= " WHERE ( freesidestatus IS NULL OR freesidestatus = '' )";

} elsif ( $cgi->param('freesidestatus') =~ /^([\w ]+)$/ ) {

  my $title = "Processed $title";
  $hashref->{'freesidestatus'} = $1;
  #$count_query .= " AND freesidestatus = '$1'";
  $count_query .= " WHERE freesidestatus = '$1'";

}

</%init>
