use RT::Ticket;
use RT::Queue;

use MIME::Parser;
use File::Temp;
use RT::EmailParser;

open (HANDLE, "data/nested-mime-sample");
my $parser = RT::EmailParser->new()
 $parser->ParseMIMEEntityFromFileHandle(\*HANDLE);
my $entity = $parser->Entity;

my $q = RT::Queue->new($RT::SystemUser);
$q->Load('general');
ok ($q->Id, "Queue is loaded");
my $Ticket = RT::Ticket->new($RT::SystemUser);
my ($tid, $ttid, $msg) =$Ticket->Create( Queue => $q->Id, Subject => "Nested mime test", MIMEObj => $entity);
ok ($tid, $msg);
ok($Ticket->Id);
